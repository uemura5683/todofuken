import Head from 'next/head'
import ReactDOM from "react-dom";
import axios from "axios"
import styles from '../styles/Home.module.css'
import React, { useState, useEffect } from "react"
import Highcharts from 'highcharts';
import HighchartsReact from 'highcharts-react-official';

function Home(prefectures) {

  const [options, setUsers] = useState([])
  , urls = 'https://opendata.resas-portal.go.jp/api/v1/population/sum/perYear?cityCode=-&prefCode=1';

  useEffect(() => {
    axios.get(urls, { headers: { 'X-API-KEY': process.env.API } })
      .then(res => setUsers(res.data))
      .catch(error => console.log(error));
  }, [] );

  const oncChangeevent = (e) => {
    e.preventDefault();
    const HighchartsReacts: Element = document.getElementById( 'HighchartsReact' );
    const root = ReactDOM.createRoot(
      HighchartsReacts
    );
    root.render(
      // <HighchartsReact highcharts={Highcharts} options={options.result.line.data} />
    )
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>都道府県一覧</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <h1 className={styles.title}>
          都道府県一覧
        </h1>
        {prefectures ? (
          <>
            <h3>都道府県</h3>
            <ul className={styles.ul}>
              {prefectures.prefectures.result.map((prefecture, idnex) => (
                <li className={styles.li} key={idnex}>
                  <label htmlFor={`id_${prefecture.prefCode}`} className={styles.label}>
                    <input
                      id={`id_${prefecture.prefCode}`}
                      type="checkbox"
                      onChange={oncChangeevent}
                      value={prefecture.prefCode}
                    />
                    {prefecture.prefName}
                  </label>
                </li>
              ))}
            </ul>
          </>
        ) : null }
        <div id="HighchartsReact"></div>
      </main>
      <footer className={styles.footer}></footer>
    </div>
  )
}
export async function getStaticProps() {
  const key = {
    headers: {'X-API-KEY': process.env.API},
  };
  const prefectures = await fetch('https://opendata.resas-portal.go.jp/api/v1/prefectures', key)
        .then((res: { json: () => any }) => res.json())
        .catch(() => null);

  return {
    props: {
      prefectures: prefectures,
    },
  };
}
export default Home;